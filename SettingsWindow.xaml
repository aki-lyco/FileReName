<Window x:Class="Explore.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="設定"
        Height="560" Width="680"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize">
	<Grid>
		<Grid.RowDefinitions>
			<RowDefinition Height="*" />
			<RowDefinition Height="Auto" />
		</Grid.RowDefinitions>

		<!-- ===== 本文：タブ ===== -->
		<TabControl Grid.Row="0" Margin="12">
			<!-- ========== インデックス設定 ========== -->
			<TabItem Header="インデックス">
				<Border Padding="12">
					<StackPanel>
						<GroupBox Header="インデックス">
							<StackPanel Margin="8,8,8,0">
								<!-- コードビハインドで UiSettings と同期 -->
								<CheckBox x:Name="AutoIndexBox"
                                          Content="フォルダ選択時に自動インデックス" />
								<CheckBox x:Name="IncludeSubsBox"
                                          Content="サブフォルダを含める（インデックス時）"
                                          Margin="0,8,0,0" />
							</StackPanel>
						</GroupBox>

						<TextBlock Margin="0,12,0,0" Foreground="#666" TextWrapping="Wrap">
							これらの設定はフォルダ選択時の自動インデックス挙動に影響します。
							重いフォルダでの応答性が気になる場合は、自動インデックスを無効にするか、
							サブフォルダの含め方を調整してください。
						</TextBlock>
					</StackPanel>
				</Border>
			</TabItem>

			<!-- ========== 鮮度（Freshness） ========== -->
			<TabItem Header="鮮度">
				<ScrollViewer VerticalScrollBarVisibility="Auto">
					<Border Padding="16">
						<StackPanel>

							<TextBlock Text="鮮度（Freshness）マーク一覧"
                                       FontSize="16" FontWeight="SemiBold" />
							<TextBlock Margin="0,6,0,0" TextWrapping="Wrap">
								ファイルとインデックス(DB)の同期状態を表すマークです。下表の基準で付与されます。
							</TextBlock>

							<!-- 表（マーク / 状態名 / 意味） -->
							<Border Margin="0,12,0,0" Padding="0"
                                    BorderBrush="#22000000" BorderThickness="1" CornerRadius="6">
								<Grid>
									<Grid.ColumnDefinitions>
										<ColumnDefinition Width="70" />
										<ColumnDefinition Width="160" />
										<ColumnDefinition Width="*" />
									</Grid.ColumnDefinitions>
									<Grid.RowDefinitions>
										<!-- ヘッダー + 6行 -->
										<RowDefinition Height="Auto"/>
										<RowDefinition Height="Auto"/>
										<RowDefinition Height="Auto"/>
										<RowDefinition Height="Auto"/>
										<RowDefinition Height="Auto"/>
										<RowDefinition Height="Auto"/>
										<RowDefinition Height="Auto"/>
									</Grid.RowDefinitions>

									<!-- ヘッダー -->
									<Border Grid.Row="0" Grid.ColumnSpan="3" Background="#0F000000" Padding="10,8">
										<Grid>
											<Grid.ColumnDefinitions>
												<ColumnDefinition Width="70"/>
												<ColumnDefinition Width="160"/>
												<ColumnDefinition Width="*"/>
											</Grid.ColumnDefinitions>
											<TextBlock Grid.Column="0" Text="マーク" FontWeight="SemiBold"/>
											<TextBlock Grid.Column="1" Text="状態名" FontWeight="SemiBold"/>
											<TextBlock Grid.Column="2" Text="意味（どういうときに付くか）" FontWeight="SemiBold"/>
										</Grid>
									</Border>

									<!-- ✅ UpToDate -->
									<Border Grid.Row="1" Grid.ColumnSpan="3" BorderBrush="#11000000" BorderThickness="0,1,0,0" Padding="10,8">
										<Grid>
											<Grid.ColumnDefinitions>
												<ColumnDefinition Width="70"/>
												<ColumnDefinition Width="160"/>
												<ColumnDefinition Width="*"/>
											</Grid.ColumnDefinitions>
											<TextBlock Grid.Column="0" Text="✅" FontSize="14" VerticalAlignment="Center"/>
											<TextBlock Grid.Column="1" Text="UpToDate" FontWeight="SemiBold" VerticalAlignment="Center"/>
											<TextBlock Grid.Column="2" TextWrapping="Wrap"
                                                       Text="DBに記録されている情報と実際のファイル（サイズ・更新日時など）が一致している → 最新状態"/>
										</Grid>
									</Border>

									<!-- 🟡 Stale -->
									<Border Grid.Row="2" Grid.ColumnSpan="3" BorderBrush="#11000000" BorderThickness="0,1,0,0" Padding="10,8">
										<Grid>
											<Grid.ColumnDefinitions>
												<ColumnDefinition Width="70"/>
												<ColumnDefinition Width="160"/>
												<ColumnDefinition Width="*"/>
											</Grid.ColumnDefinitions>
											<TextBlock Grid.Column="0" Text="🟡" FontSize="14" VerticalAlignment="Center"/>
											<TextBlock Grid.Column="1" Text="Stale" FontWeight="SemiBold" VerticalAlignment="Center"/>
											<TextBlock Grid.Column="2" TextWrapping="Wrap"
                                                       Text="DBの情報と実物がズレている（更新日時やサイズが変わったなど） → 再インデックス対象"/>
										</Grid>
									</Border>

									<!-- ➕ Unindexed -->
									<Border Grid.Row="3" Grid.ColumnSpan="3" BorderBrush="#11000000" BorderThickness="0,1,0,0" Padding="10,8">
										<Grid>
											<Grid.ColumnDefinitions>
												<ColumnDefinition Width="70"/>
												<ColumnDefinition Width="160"/>
												<ColumnDefinition Width="*"/>
											</Grid.ColumnDefinitions>
											<TextBlock Grid.Column="0" Text="➕" FontSize="14" VerticalAlignment="Center"/>
											<TextBlock Grid.Column="1" Text="Unindexed" FontWeight="SemiBold" VerticalAlignment="Center"/>
											<TextBlock Grid.Column="2" TextWrapping="Wrap"
                                                       Text="ファイルシステム上にはあるけど、まだDBに入っていない → 新規追加"/>
										</Grid>
									</Border>

									<!-- ⛔ Orphan -->
									<Border Grid.Row="4" Grid.ColumnSpan="3" BorderBrush="#11000000" BorderThickness="0,1,0,0" Padding="10,8">
										<Grid>
											<Grid.ColumnDefinitions>
												<ColumnDefinition Width="70"/>
												<ColumnDefinition Width="160"/>
												<ColumnDefinition Width="*"/>
											</Grid.ColumnDefinitions>
											<TextBlock Grid.Column="0" Text="⛔" FontSize="14" VerticalAlignment="Center"/>
											<TextBlock Grid.Column="1" Text="Orphan" FontWeight="SemiBold" VerticalAlignment="Center"/>
											<TextBlock Grid.Column="2" TextWrapping="Wrap"
                                                       Text="DBにはあるけど、実際のファイルは見つからない → 削除や移動で消えた可能性"/>
										</Grid>
									</Border>

									<!-- 🔄 Indexing -->
									<Border Grid.Row="5" Grid.ColumnSpan="3" BorderBrush="#11000000" BorderThickness="0,1,0,0" Padding="10,8">
										<Grid>
											<Grid.ColumnDefinitions>
												<ColumnDefinition Width="70"/>
												<ColumnDefinition Width="160"/>
												<ColumnDefinition Width="*"/>
											</Grid.ColumnDefinitions>
											<TextBlock Grid.Column="0" Text="🔄" FontSize="14" VerticalAlignment="Center"/>
											<TextBlock Grid.Column="1" Text="Indexing" FontWeight="SemiBold" VerticalAlignment="Center"/>
											<TextBlock Grid.Column="2" TextWrapping="Wrap"
                                                       Text="いまインデックス処理中（走査 or DB反映中）"/>
										</Grid>
									</Border>

									<!-- ❗ Error -->
									<Border Grid.Row="6" Grid.ColumnSpan="3" BorderBrush="#11000000" BorderThickness="0,1,0,0" Padding="10,8">
										<Grid>
											<Grid.ColumnDefinitions>
												<ColumnDefinition Width="70"/>
												<ColumnDefinition Width="160"/>
												<ColumnDefinition Width="*"/>
											</Grid.ColumnDefinitions>
											<TextBlock Grid.Column="0" Text="❗" FontSize="14" VerticalAlignment="Center"/>
											<TextBlock Grid.Column="1" Text="Error" FontWeight="SemiBold" VerticalAlignment="Center"/>
											<TextBlock Grid.Column="2" TextWrapping="Wrap"
                                                       Text="アクセス拒否（権限なし）、壊れている、IOエラーなどで処理できなかった"/>
										</Grid>
									</Border>
								</Grid>
							</Border>

							<TextBlock Margin="0,10,0,0" Foreground="#666" TextWrapping="Wrap">
								※ マークは一覧表示や進捗UIで使われます。表示仕様は将来変更される場合があります。
							</TextBlock>
						</StackPanel>
					</Border>
				</ScrollViewer>
			</TabItem>

			<!-- ========== AI ========== -->
			<TabItem Header="AI">
				<ScrollViewer VerticalScrollBarVisibility="Auto">
					<Border Padding="16">
						<StackPanel>
							<TextBlock Text="Gemini API キー" FontSize="16" FontWeight="SemiBold"/>
							<TextBlock Foreground="#666" TextWrapping="Wrap" Margin="0,6,0,0">
								AI検索・分類などで使用する API キーを保存します。保存先は「ユーザー環境変数」または
								「アプリデータ（%APPDATA%\Explore\gemini_api_key.txt）」から選べます。
							</TextBlock>

							<!-- 保存先 -->
							<GroupBox Header="保存先" Margin="0,8,0,0">
								<StackPanel Margin="8,4,8,0">
									<RadioButton x:Name="StoreEnvRadio" Content="ユーザー環境変数（GEMINI_API_KEY）" IsChecked="True"/>
									<RadioButton x:Name="StoreFileRadio" Content="アプリデータに保存（%APPDATA%\Explore\gemini_api_key.txt）" Margin="0,4,0,0"/>
								</StackPanel>
							</GroupBox>

							<!-- API キー入力 -->
							<GroupBox Header="API キー" Margin="0,8,0,0">
								<Grid Margin="8">
									<Grid.RowDefinitions>
										<RowDefinition Height="Auto"/>
										<RowDefinition Height="Auto"/>
									</Grid.RowDefinitions>
									<Grid.ColumnDefinitions>
										<ColumnDefinition Width="*"/>
										<ColumnDefinition Width="Auto"/>
									</Grid.ColumnDefinitions>

									<!-- Password / Plain 切替 -->
									<PasswordBox x:Name="ApiKeyBox" Grid.Row="0" Grid.Column="0" Margin="0,0,8,0" />
									<TextBox x:Name="ApiKeyBoxPlain" Grid.Row="0" Grid.Column="0" Margin="0,0,8,0" Visibility="Collapsed"/>

									<CheckBox x:Name="ShowApiSwitch" Grid.Row="0" Grid.Column="1"
                                              Content="表示" VerticalAlignment="Center"
                                              Checked="OnShowApiChecked" Unchecked="OnShowApiChecked"/>

									<TextBlock x:Name="ApiSourceNote" Grid.Row="1" Grid.ColumnSpan="2"
                                               Foreground="#666" Margin="0,6,0,0" TextWrapping="Wrap"/>
								</Grid>
							</GroupBox>

							<TextBlock Foreground="#666" TextWrapping="Wrap" Margin="0,8,0,0">
								保存後、現在のアプリでは直ちに利用可能です（環境変数はこのプロセスにも反映します）。
								ほかのアプリ／古いプロセスでは再起動が必要な場合があります。
							</TextBlock>
						</StackPanel>
					</Border>
				</ScrollViewer>
			</TabItem>
		</TabControl>

		<!-- ===== フッター：ボタン ===== -->
		<StackPanel Grid.Row="1"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Margin="12">
			<Button Width="90" Margin="0,0,8,0"
                    Click="OnCancel"
                    IsCancel="True">キャンセル</Button>
			<Button Width="90"
                    Click="OnOK"
                    IsDefault="True">OK</Button>
		</StackPanel>
	</Grid>
</Window>
