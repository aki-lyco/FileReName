<UserControl x:Class="Explore.FilesControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:fs="clr-namespace:Explore.FileSystem">
	<Grid>
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="*"/>
			<RowDefinition Height="Auto"/>
		</Grid.RowDefinitions>

		<!-- ツールバー -->
		<StackPanel Orientation="Horizontal" Margin="8" Grid.Row="0">
			<CheckBox x:Name="IncludeSubsCheck"
					  Content="サブフォルダーを含める"
					  IsChecked="False"
					  Checked="IncludeSubs_Checked"
					  Unchecked="IncludeSubs_Unchecked"
					  Margin="0,0,12,0"/>
			<CheckBox x:Name="AutoIndexCheck"
					  Content="自動インデックス"
					  IsChecked="False"
					  Checked="AutoIndex_Checked"
					  Unchecked="AutoIndex_Unchecked"
					  Margin="0,0,12,0"/>
			<Button Content="DBにいれる" Width="110" Height="26"
					Click="OnIndexCurrentFolderClick" Margin="0,0,6,0"/>
			<Button Content="停止" Width="96" Height="26"
					Click="OnCancelIndexClick" Margin="0,0,6,0"/>
			<Button Content="DB情報" Width="96" Height="26"
					Click="OnShowDbCountsClick"/>
			<TextBlock TextAlignment="Right" Margin="16,0,0,0" VerticalAlignment="Center">
				<Run Text="登録済み: "/>
				<Run Text="{Binding IndexedCountText}"/>
				<Run Text=" 件"/>
			</TextBlock>
		</StackPanel>

		<!-- メイン：左=ツリー、右=ファイル一覧 -->
		<Grid Grid.Row="1" Margin="8">
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="280"/>
				<ColumnDefinition Width="5"/>
				<ColumnDefinition Width="*"/>
			</Grid.ColumnDefinitions>

			<!-- フォルダツリー（ExplorerBackendの FolderNode を使う） -->
			<TreeView x:Name="TreeViewRoot"
					  Grid.Column="0"
					  ItemsSource="{Binding Vm.Roots}"
					  SelectedItemChanged="OnFolderSelected">
				<!-- 展開イベント（各アイテムの展開で遅延ロード） -->
				<TreeView.ItemContainerStyle>
					<Style TargetType="TreeViewItem">
						<EventSetter Event="Expanded" Handler="OnNodeExpanded"/>
					</Style>
				</TreeView.ItemContainerStyle>

				<!-- ノード表示 -->
				<TreeView.Resources>
					<HierarchicalDataTemplate DataType="{x:Type fs:FolderNode}" ItemsSource="{Binding Children}">
						<TextBlock Text="{Binding Name}"/>
					</HierarchicalDataTemplate>
				</TreeView.Resources>
			</TreeView>

			<!-- グリッパー -->
			<GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch" Background="#20000000"/>

			<!-- ファイル一覧（Explore.FileSystem.FileItem のプロパティを表示） -->
			<ListView x:Name="FilesGrid"
					  Grid.Column="2"
					  ItemsSource="{Binding Vm.Files}">
				<ListView.View>
					<GridView>
						<GridViewColumn Header="名前" DisplayMemberBinding="{Binding Name}" Width="240"/>
						<GridViewColumn Header="拡張子" DisplayMemberBinding="{Binding Extension}" Width="90"/>
						<GridViewColumn Header="サイズ" DisplayMemberBinding="{Binding Size}" Width="110"/>
						<GridViewColumn Header="更新日時" DisplayMemberBinding="{Binding LastWriteTime}" Width="160"/>
						<GridViewColumn Header="パス" DisplayMemberBinding="{Binding FullPath}" Width="400"/>
					</GridView>
				</ListView.View>
			</ListView>
		</Grid>

		<!-- ステータス -->
		<DockPanel Grid.Row="2" Margin="8">
			<ProgressBar Width="220" Height="12"
						 Minimum="0" Maximum="100"
						 Value="{Binding IndexPercent}" />
			<TextBlock Margin="8,0,0,0" VerticalAlignment="Center"
					   Text="{Binding IndexStatusText}"/>
		</DockPanel>
	</Grid>
</UserControl>
